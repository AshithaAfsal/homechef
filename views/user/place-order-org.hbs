<!-- Page Title
		============================================= -->
<section id="page-title">

	<div class="container clearfix">
		<h1>Checkout</h1>
		<ol class="breadcrumb">
			<li class="breadcrumb-item"><a href="/">Home</a></li>
			<li class="breadcrumb-item"><a href="/cart">Cart</a></li>
			<li class="breadcrumb-item active" aria-current="page">Checkout</li>
		</ol>
	</div>

</section><!-- #page-title end -->

<!-- Content
		============================================= -->
<section id="content">
	<div class="content-wrap ">
		<div class="container clearfix ">
			<div class="row col-mb-50 gutter-50">
			<form id="checkout-form" name="checkout-form" class="row mb-0" action="#" method="post">
				<div class="col-lg-8 ">
					<h3>Billing Address</h3>
					  
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Unde, vel odio non dicta provident sint
						ex autem mollitia dolorem illum repellat ipsum aliquid illo similique sapiente fugiat minus
						ratione.</p>

				
						 <input type="text"  name="userId" value="{{user._id}}" hidden>


						<div class="w-100"></div>

						<div class="col-12 form-group">
							<label for="billing-address">Address:</label>
							<input type="text" id="billing-address" name="billing_address" value=""
								class="sm-form-control" required/>
						</div>
						<div class="col-12 form-group">
							<label for="billing-city">City / Town</label>
							<input type="text" id="billing-city" name="billing_city" value="" class="sm-form-control" required/>
						</div>
						<div class="col-12 form-group">
							<label for="billing-pincode">Pincode:</label>
							<input type="text" id="billing-pincode" name="billing_pincode" value=""
								class="sm-form-control" required/>
						</div>
						<div class="col-12 form-group">
							<label for="billing-state">State </label>
							<input type="text" id="billing-state" name="billing_state" value=""
								class="sm-form-control" required/>
						</div>

				
				</div>

				

				<div class="w-100"></div>

				<div class="col-lg-6">
					<h4>Cart Totals</h4>

					<div class="table-responsive">
						<table class="table cart">
							<tbody>
								<tr class="cart_item">
									<td class="border-top-0 cart-product-name">
										<strong>Cart Subtotal</strong>
									</td>

									<td class="border-top-0 cart-product-name">
										<span class="amount">{{total}}</span>
									</td>
								</tr>
								<tr class="cart_item">
									<td class="cart-product-name">
										<strong>Shipping</strong>
									</td>

									<td class="cart-product-name">
										<span class="amount">Free Delivery</span>
									</td>
								</tr>
								<tr class="cart_item">
									<td class="cart-product-name">
										<strong>Total</strong>
									</td>

									<td class="cart-product-name">
										<span class="amount color lead"><strong>{{total}} Rs.</strong></span>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>

				<div class="col-lg-6">
					<h4>Payment Options</h4>
					<!-- Default checked -->
					<div class="custom-control custom-radio">
						<input type="radio" class="custom-control-input" id="defaultChecked" name="payment-method"
							checked value="COD">

						<label class="custom-control-label" for="defaultChecked">Cash On Delivery</label>
					</div><br>

					<!-- Default unchecked -->
					<div class="custom-control custom-radio">
						<input type="radio" class="custom-control-input" id="defaultUnchecked" name="payment-method"
							value="ONLINE">
						<label class="custom-control-label" for="defaultUnchecked">Razorpay Payment</label>
					</div><br>
					 <div class="custom-control custom-radio">
						<input type="radio" class="custom-control-input" id="paypal1" name="payment-method"
							value="PAYPAL">
						<label class="custom-control-label " for="paypal1">Paypal</label>
					</div><br> 
					

					{{!-- <a href="#" class="button button-3d float-left">Place Order</a> --}}
					<button type="submit" class="float-left btn btn-success mr-5 mb-2">Checkout</button>

				</div>
				<input type="hidden" name="cart_id" id="cart_id" value="{{total}}"/>
				<!-- Set up a container element for the button -->
    <div id="paypal-button-container"></div>

			  <div id="paypal_btn" style="display: none;"> 
				  {{!-- <a href="" class="paypal-payment-button">paypal</a> --}}
				  {{!-- <div class="paypal-payment-button" ></div> --}}
			 </div>
			</form>
{{!-- 			
			<form action="/pay" method="post">
					{{!-- <label  class="float-left  mb-2">Paypal</label> -}}
						<input type="submit" value="PayPal"  class="float-right btn btn-success mr-5 mb-2">
					</form> --}}
			</div>
		</div>
	</div>
	
</section><!-- #content end -->


<script>
	$(document).ready(function () {
		
		//form validation
		$("#checkout-form").validate({
			// Specify validation rules
			rules: {
				billing_address: {
					required:true,
				
				},
				billing_city:{
					required:true,
				},
				billing_pincode:{
					required:true,
					digits:true,
					minlength:6,
					maxlength:6
				}			
			},
			messages: {
				billing_address: {
					required: "Please Enter your address",
				},
				billing_city:{
					required:"Please Enter Your City",
				},
				billing_pincode:{
					required:"Please Enter pincode",
					digits:"Please Enter a Valid Pincode",
					minlength:"Your Pincode Must be 6 digits",
					maxlength:"Your Pincode Must be 6 digits"
				}
				
			},

		});

	});

</script>

<script>
  $("#checkout-form").submit((e)=>{  
    e.preventDefault()
	if($('#checkout-form').valid() == true){
		 $.ajax({
        url:'/place-order',
        method:'post',
        data:$('#checkout-form').serialize(),
        success:(response)=>{
            if(response.cod_success){
                location.href='/order_success'
            }
            else if(response.cod_success==false){
					alert("hai")
				paypalPayment(response)
				// location.href='/paypal_order'
			//	location.href='/paypal_order'
            }
			else{
				razorpayPayment(response)			
			}
        }
    })
  
	}
	return false;
   
})
function razorpayPayment(order){  
	 
        var options = {
		
        "key": "rzp_test_P1qJn93ykpKDDb", // Enter the Key ID generated from the Dashboard
        "amount": order.amount, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
        "currency": "INR",
        "name": "Crossroads",
        "description": "Test Transaction",
        "image": "https://example.com/your_logo",
        "order_id": order.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
        "handler": function (response){
          
          //alert(response.razorpay_payment_id);alert(response.razorpay_order_id);alert(response.razorpay_signature);         
            verifyPayment(response,order)
        },
        "prefill": {
            "name": "Demo",
            "email": "demo@example.com",
            "contact": "9999999999"
        },
        "notes": {
            "address": "Razorpay Corporate Office"
        },
        "theme": {
            "color": "#3399cc"
        }
    };
    var rzp1 = new Razorpay(options);
    rzp1.open();    
}
function verifyPayment(payment,order){
	
 $.ajax({
    url:'verify_payment',
    data:{
        payment,
        order
    },
    method:'post',
    success:(response)=>{
        if(response.status){
            location.href='/order_success'
        }
        else{            
            alert("Payment Failed")
        }
    }
})
}
function paypalPayment1(){
	paypal.Button.render({
	commit: true
	});

	
 $.ajax({
    url:'pay',
    //data:{
    //    payment,
    //    order
   // },
    method:'post',
   // success:(response)=>{
      //  if(response.status){
      //      location.href='/order_success'
      //  }
       // else{            
       //     alert("Payment Failed")
       // }
    //}
})
}
   
</script>

  <script
    src="https://www.paypal.com/sdk/js?client-id=ARz77seSj_48d8nnhv7Djub47ZZbnIC4LRxCwU_4-e2ZCoscT4cB3CIImB1EfUjAiJHoCPcCIVVw7BEO&disable-funding=credit,card"> // Required. Replace SB_CLIENT_ID with your sandbox client ID.
  </script>
<script src="/javascripts/paypal.js"></script>
{{!-- <script>paypal.Buttons().render('body');</script> --}}